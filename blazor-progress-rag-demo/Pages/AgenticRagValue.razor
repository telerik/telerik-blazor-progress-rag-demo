@page "/agentic-rag-value"
@page "/value-proposition"
@using Telerik.Blazor.Components
@using blazor_progress_rag_demo.Services
@inject NucliaSearchService NucliaService

<PageTitle>Agentic RAG Value</PageTitle>

<div class="value-proposition-container k-overflow-y-auto k-overflow-x-hidden value-proposition k-pos-relative">
    @if (!HasResults)
    {
        <VectorsBackground Show="true" />
        
        @* Hero Section *@
        <div class="k-d-flex k-flex-column k-pos-relative k-p-12 hero">
            <div class="k-d-flex k-flex-column k-w-full k-gap-8">
                <h1 class="value-proposition-title !k-mb-0 k-h1">
                    Progress Agentic RAG Value
                </h1>
                <p class="value-proposition-description !k-mb-0">
                    Generate a customized value proposition showing exactly how Nuclia delivers ROI for your specific industry, company size, and use case.
                </p>
            </div>
        </div>

        <section class="k-py-16 k-text-center k-mx-auto k-justify-self-center">
            <div class="k-mb-16 k-d-flex k-flex-col k-gap-7 gradient-wrapper k-pos-relative">
                <h2 class="k-h2 !k-mb-0">Configure Your Scenario</h2>
                <p class="k-font-size-lg !k-mb-0">Tell us about your organization and we'll create a tailored value proposition</p>
            </div>

            <div class="k-gap-8 k-d-flex k-flex-col">
                @* Industry Section *@
                <div class="value-proposition-card k-d-flex k-flex-column k-gap-5 k-bg-surface k-p-6 k-mx-auto k-w-full k-box-sizing-border">
                    <h3 class="k-h3 k-align-self-start !k-mb-0">Industry *</h3>
                    <div class="k-d-grid k-grid-cols-md-3 k-gap-3">
                        @foreach (var item in Industries)
                        {
                            <TelerikToggleButton Selected="@(SelectedIndustry == item)"
                                                 SelectedChanged="@((bool selected) => { if (selected) SelectIndustry(item); })"
                                                 Class="k-p-6 k-overflow-hidden">
                                @item
                            </TelerikToggleButton>
                        }
                    </div>
                </div>

                @* Company Size Section *@
                <div class="value-proposition-card k-d-flex k-flex-column k-gap-5 k-bg-surface k-p-5 k-mx-auto k-w-full k-box-sizing-border">
                    <h3 class="k-h3 k-align-self-start">Company Size *</h3>
                    <div class="k-d-grid k-grid-cols-md-2 k-gap-3">
                        @foreach (var item in CompanySizes)
                        {
                            <TelerikToggleButton Selected="@(SelectedCompanySize == item)"
                                                 SelectedChanged="@((bool selected) => { if (selected) SelectCompanySize(item); })"
                                                 Class="k-p-6">
                                @item
                            </TelerikToggleButton>
                        }
                    </div>
                </div>

                @* Data Types Section *@
                <div class="value-proposition-card k-d-flex k-flex-column k-gap-5 k-bg-surface k-p-5 k-mx-auto k-w-full k-box-sizing-border">
                    <h3 class="k-h3 k-align-self-start">Data Types * (Select all that apply)</h3>
                    <div class="k-d-grid k-grid-cols-md-3 k-gap-3">
                        @foreach (var item in DataTypes)
                        {
                            <TelerikToggleButton Selected="@(SelectedDataTypes.Contains(item))"
                                                 SelectedChanged="@((bool selected) => ToggleDataType(item))"
                                                 Class="k-p-6">
                                @item
                            </TelerikToggleButton>
                        }
                    </div>
                </div>

                @* Primary Use Case Section *@
                <div class="value-proposition-card k-d-flex k-flex-column k-gap-5 k-bg-surface k-p-5 k-mx-auto k-w-full k-box-sizing-border">
                    <h3 class="k-h3 k-align-self-start">Primary Use Case *</h3>
                    <div class="k-d-grid k-grid-cols-md-2 k-gap-3">
                        @foreach (var item in UseCases)
                        {
                            <TelerikToggleButton Selected="@(SelectedUseCase == item)"
                                                 SelectedChanged="@((bool selected) => { if (selected) SelectUseCase(item); })"
                                                 Class="k-p-6">
                                @item
                            </TelerikToggleButton>
                        }
                    </div>
                </div>

                @* Additional Details Section *@
                <div class="value-proposition-card k-d-flex k-flex-column k-gap-5 k-bg-surface k-p-5 k-mx-auto k-w-full k-box-sizing-border">
                    <h3 class="k-h3 k-align-self-start">Additional Details (Optional)</h3>
                    <TelerikTextArea @bind-Value="@AdditionalDetails"
                                     Class="value-proposition-textarea k-textarea"
                                     Placeholder="Provide any additional context about your organization, specific challenges, or requirements that would help create a more targeted value proposition..."
                                     Rows="4"
                                     ResizeMode="@TextAreaResizeMode.None" />
                </div>
            </div>

            <TelerikButton Size="@ThemeConstants.Button.Size.Large"
                           ThemeColor="@ThemeConstants.Button.ThemeColor.Primary"
                           OnClick="@HandleGenerate"
                           Enabled="@(!IsLoading)"
                           Icon="@SvgIcon.Sparkles"
                           Class="k-gap-3 generate-button k-mt-16">
                Generate Value Proposition
            </TelerikButton>
        </section>
    }
    else
    {
        <div class="value-proposition-results-container k-d-flex k-flex-column k-w-full">
            @* Hero section with title and summary *@
            <section class="@GetResultsHeroClass()">
                @if (IsLoading)
                {
                    <GradientLoader Title="Generating<br />Custom Value Proposition"
                                    Subtitle="Analyzing industry requirements..." />
                }

                @if (!IsLoading)
                {
                    <h2 class="value-proposition-results-title gradient-heading k-text-center !k-mb-0">
                        Custom Value Proposition
                    </h2>
                }

                <div class="@GetUserSelectionClass()">
                    <div class="k-d-flex k-flex-column k-gap-6 k-flex-1">
                        <div class="k-d-flex k-flex-column">
                            <div class="value-proposition-label">Industry & Size:</div>
                            <div class="value-proposition-value">@SelectedIndustry</div>
                            <div class="value-proposition-value">@SelectedCompanySize</div>
                        </div>
                        <div class="k-d-flex k-flex-column">
                            <div class="value-proposition-label">Primary Use Case:</div>
                            <div class="value-proposition-value">@SelectedUseCase</div>
                        </div>
                    </div>
                    <div class="k-d-flex k-flex-column k-gap-6 k-flex-1">
                        <div class="k-d-flex k-flex-column">
                            <div class="value-proposition-label">Data Types:</div>
                            <div class="value-proposition-value-compact">@string.Join(", ", SelectedDataTypes)</div>
                        </div>
                        @if (!string.IsNullOrEmpty(AdditionalDetails))
                        {
                            <div class="k-d-flex k-flex-column">
                                <div class="value-proposition-additional-label">Additional Details:</div>
                                <div class="value-proposition-value-compact">@AdditionalDetails</div>
                            </div>
                        }
                    </div>
                </div>
            </section>

            @* Results content *@
            @if (!IsLoading && !string.IsNullOrEmpty(ValueProposition))
            {
                <section class="value-proposition-results-section k-d-flex k-flex-column k-gap-8 k-align-items-center k-px-6 k-py-16">
                    <div class="value-proposition-results-content markdown-content k-w-full">
                        <MarkdownContent Text="@ValueProposition" />
                    </div>
                </section>
            }
        </div>
    }
</div>

@code {
    private string? SelectedIndustry { get; set; }
    private string? SelectedCompanySize { get; set; }
    private List<string> SelectedDataTypes { get; set; } = new();
    private string? SelectedUseCase { get; set; }
    private string? AdditionalDetails { get; set; }
    private bool IsLoading { get; set; } = false;
    private string ValueProposition { get; set; } = string.Empty;

    private bool HasResults => !string.IsNullOrEmpty(ValueProposition) || IsLoading;

    private List<string> Industries = new()
    {
        "Financial Services", "Healthcare", "Manufacturing", "Technology",
        "Retail & E-commerce", "Energy & Utilities", "Government", "Education",
        "Professional Services", "Media & Entertainment", "Transportation & Logistics",
        "Real Estate", "Other"
    };

    private List<string> CompanySizes = new()
    {
        "Small Business (1-100 employees)", "Mid-Market (101-1,000 employees)",
        "Large Enterprise (1,001-10,000 employees)", "Global Enterprise (10,000+ employees)"
    };

    private List<string> DataTypes = new()
    {
        "Customer Data", "Product Documentation", "Internal Knowledge Base",
        "Compliance Documents", "Training Materials", "Technical Documentation",
        "Sales & Marketing Content", "HR Policies & Procedures", "Financial Reports",
        "Research & Development", "Legal Documents", "Operational Procedures"
    };

    private List<string> UseCases = new()
    {
        "Customer Support Enhancement", "Employee Self-Service",
        "Sales Enablement", "Compliance & Risk Management",
        "Research & Development", "Knowledge Management",
        "Process Automation", "Decision Support",
        "Content Management", "Other"
    };

    private void ToggleDataType(string dataType)
    {
        if (SelectedDataTypes.Contains(dataType))
        {
            SelectedDataTypes.Remove(dataType);
        }
        else
        {
            SelectedDataTypes.Add(dataType);
        }
    }

    private string GenerateQuestion()
    {
        var parts = new List<string>();

        parts.Add("Generate a compelling value proposition for Progress Agentic RAG and Telerik DevTools");

        if (!string.IsNullOrEmpty(SelectedIndustry))
        {
            parts.Add($"for a company in the {SelectedIndustry} industry");
        }

        if (!string.IsNullOrEmpty(SelectedCompanySize))
        {
            parts.Add($"with {SelectedCompanySize} employees");
        }

        if (SelectedDataTypes.Count > 0)
        {
            parts.Add($"that works with {string.Join(", ", SelectedDataTypes)}");
        }

        if (!string.IsNullOrEmpty(SelectedUseCase))
        {
            parts.Add($"focusing on {SelectedUseCase}");
        }

        if (!string.IsNullOrEmpty(AdditionalDetails))
        {
            parts.Add($"Additional context: {AdditionalDetails}");
        }

        parts.Add("Highlight the benefits of combining AI-powered search with enterprise-grade UI components.");

        return string.Join(" ", parts);
    }

    private async Task HandleGenerate()
    {
        var question = GenerateQuestion();

        IsLoading = true;
        ValueProposition = string.Empty;
        StateHasChanged();

        try
        {
            await NucliaService.AskVerseAsync(question, (chunk) =>
            {
                ValueProposition = chunk;
                InvokeAsync(StateHasChanged);
            });
        }
        catch (Exception ex)
        {
            ValueProposition = $"Sorry, I encountered an error: {ex.Message}";
        }
        finally
        {
            IsLoading = false;
            StateHasChanged();
        }
    }

    private void SelectIndustry(string item) => SelectedIndustry = item;
    private void SelectCompanySize(string item) => SelectedCompanySize = item;
    private void SelectUseCase(string item) => SelectedUseCase = item;

    private string GetResultsHeroClass()
    {
        var baseClass = "value-proposition-results-hero k-d-flex k-flex-column k-gap-9 k-align-items-center k-py-12 k-px-6 k-gap-8";
        return IsLoading ? baseClass : $"{baseClass} hero";
    }

    private string GetUserSelectionClass()
    {
        var baseClass = "value-proposition-user-selection k-p-6 k-d-flex k-flex-col k-flex-md-row k-gap-6 k-p-4 k-box-sizing-border k-w-full";
        return IsLoading ? $"{baseClass} user-selection-wrapper-loading" : $"{baseClass} user-selection-wrapper";
    }
}
